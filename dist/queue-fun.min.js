/*!
 * queue-fun v1.0.0
 * Homepage https://github.com/cnwhy/queue-fun
 * License BSD
 */
!function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){!function(e,t){if("function"==typeof define&&(define.amd||define.cmd))define([],t);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("加载 "+e+" 模块失败！，请检查您的环境！");var n="undefined"!=typeof window?window:self;n[e]=t()}}("QueueFun",function(){return e("../lib/index.js")(e("easy-promise/setTimeout"))})},{"../lib/index.js":2,"easy-promise/setTimeout":3}],2:[function(e,t,n){"use strict";var r=e("extend-promise/src/extendClass");t.exports=function(e){function t(e){p=n.Q={},r(e,p)}function n(e){var t={event_succ:function(){},event_err:function(){},event_begin:function(){},event_end:function(){},event_add:function(){},retry:0,retry_type:0,timeout:0};this.max=e,this.lins=[],this.ing=0,this.isStart=0,this.isStop=0,this._option=t,this.onError=h;var n=arguments[arguments.length-1];if("object"==typeof n)for(var r in t)"undefined"!=typeof n[r]&&(this._option[r]=n[r])}function o(e){return p.resolve(1).then(function(){return e()})}function i(e){var t={errNo:0,run_queue_event:1,regs:[]},n=["event_succ","event_err","retry","retry_type","run_queue_event","timeout","self"];for(var r in t)this[r]=t[r];this.fun=e[0];var o=e[1];o instanceof Array&&(this.regs=o);var i=e.length>1&&e[e.length-1];if(i&&"object"==typeof i&&!(i instanceof Array))for(r in n){var u=n[r];"undefined"!=typeof i[u]&&(this[u]=i[u])}this.defer=p.defer()}function u(e,t,n){var r=t[e];return"undefined"!=typeof r?r:n._option[e]}function s(e,t,n){var r=t;if(e&&"function"==typeof e)try{e.apply(r,n)}catch(e){"function"==typeof t.onError&&t.onError(e)}}function f(e){var t=this._option[e],n=Array.prototype.slice.call(arguments,1);s.call(null,t,this,n)}function c(e,t){var n=this[e],r=Array.prototype.slice.call(arguments,2);s.call(null,n,t,r)}function a(e){f.call(this,"event_add",e,this)}function l(e){if(e instanceof i)return e;if("function"==typeof e)return new i(Array.prototype.slice.call(arguments));throw new TypeError("Queues only support function, '"+e+"' is not function")}var p;t(e);var h=function(){return"object"==typeof console&&"function"==typeof console.error?function(e){console.error(e)}:function(){}}();return n.setPromise=t,n.prototype={option:function(e){return 1==arguments.length?this._option[e]:void(arguments.length>1&&(this._option[e]=arguments[1]))},next:function(){var e=this;if(this.ing<this.max&&!this.isStop){var t=this.lins.shift();if(t){var n,r=t.run_queue_event,i=0,s=u("timeout",t,e),a=u("retry",t,e),l=u("retry_type",t,e),p=function(){return n&&clearTimeout(n),n=0,!!i++||void e.ing--},h=function(n){p()||(t.defer&&t.defer.resolve(n),c.call(t,"event_succ",e,n,e,t),r&&f.call(e,"event_succ",n,e,t))},v=function(n){p()||(t.errNo++,a>t.errNo-1?l?e.jump(t):e.go(t):(t.defer&&t.defer.reject(n),c.call(t,"event_err",e,n,e,t),r&&f.call(e,"event_err",n,e,t)))};o(function(){return t.fun.apply(t.self||null,t.regs)}).then(h,v).then(function(){e.isStop||e.start()});if(e.ing+=1,"undefined"!=typeof t.timeout||e._option.timeout>0){var s=e._option.timeout;s="undefined"!=typeof t.timeout?+t.timeout:s,s>0&&(n=setTimeout(function(){v("timeout")},s))}}t&&!e.isStart&&(e.isStart=1,f.call(e,"event_begin",e)),!t&&0===e.ing&&e.isStart&&(e.isStart=0,f.call(e,"event_end",e))}},push:function(){var e=this,t=l.apply(0,arguments);return e.lins.push(t),a.call(e,t),t.defer.promise},unshift:function(){var e=this,t=l.apply(0,arguments);return e.lins.unshift(t),a.call(e,t),t.defer.promise},go:function(e){var t=this,n=l.apply(0,arguments);return t.lins.push(n),a.call(t,n),t.start(),n.defer.promise},jump:function(e){var t=this,n=l.apply(0,arguments);return t.lins.unshift(n),a.call(t,n),t.start(),n.defer.promise},all:function(e,t,n){for(var r=[],o=this,i=0;i<e.length;i++)+function(){var t=i,u=e[t],s=n?o.unshift.apply(o,u):o.push.apply(o,u);r.push(s)}();var u=p.defer();return p.all(r).then(function(e){u.resolve(e)},function(e){u.reject(e)}),t&&this.start(),u.promise},allLike:function(e,t,n){var r,o,i,u=[],s=2,f=this;"object"==typeof n?(r=n,s++):n=null,o=arguments[s],i=arguments[++s];for(var c=0;c<e.length;c++)+function(){var r=c,o=Array.prototype.concat.call([],e[r]),s=i?f.unshift(t,o,n):f.push(t,o,n);u.push(s)}();var a=p.defer();return p.all(u).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise},allEach:function(e,t,n){var r,o,i,u=[],s=2,f=this;"object"==typeof n?(r=n,s++):n=null,o=arguments[s],i=arguments[++s];for(var c in e)+function(){var r=c,o=Array.prototype.concat.call([],e[r],r,e),s=i?f.unshift(t,o,n):f.push(t,o,n);u.push(s)}();var a=p.defer();return p.all(u).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise},allMap:function(e,t,n){var r,o,i,u={},s=2,f=this;"object"==typeof n?(r=n,s++):n=null,o=arguments[s],i=arguments[++s];for(var c in e)+function(){var r=c,o=Array.prototype.concat.call([],e[r],r,e),s=i?f.unshift(t,o,n):f.push(t,o,n);u[r]=s}();var a=p.defer();return p.allMap(u).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise},start:function(){this.isStop=0;do this.next();while(this.lins.length&&this.ing<this.max)},stop:function(){this.isStop=1},setMax:function(e){try{if(e=+e>>0,!(e>0))throw new Error('The "max" value is invalid');this.max=e,!this.isStop&&this.ing&&this.start()}catch(e){"function"==typeof this.onError&&this.onError(e)}},clear:function(e){for(;this.lins.length;){var t=this.lins.shift();t.defer.reject(e)}}},n.prototype.allArray=n.prototype.allLike,n}},{"extend-promise/src/extendClass":5}],3:[function(e,t,n){t.exports=e("./src")(function(e){setTimeout(e,0)})},{"./src":4}],4:[function(e,t,n){"use strict";t.exports=function(e){function t(e,r){if(n(r))r.then(e.resolve,e.reject);else if(!r||"function"!=typeof r&&"object"!=typeof r)e.resolve(r);else{var o,i=!1;try{o=r.then,"function"==typeof o?o.call(r,function(n){i||(i=!0,t(e,n))},function(t){i||(i=!0,e.reject(t))}):e.resolve(r)}catch(t){i||(i=!0,e.reject(t))}}}function n(e){return e instanceof r}function r(e){function n(e){o.call(f,1,e)}function r(e){o.call(f,0,e)}function i(e){if(!c)return c=!0,f===e?r(new TypeError("The promise and its value refer to the same object")):void t({resolve:n,reject:r},e)}function u(e){c||(c=!0,r(e))}var f=this;this.status=-1,this._events=[];var c=!1;if(this.resolve=i,this.reject=u,e!==s&&"function"==typeof e)try{e(this.resolve,this.reject)}catch(e){this.reject(e)}}function o(e,t){var n=this;~this.status||(this.status=e,e?this.value=t:this.reason=t,i.call(n))}function i(){if(~this.status){for(var e=this,t=e._events,n=e.status?e.value:e.reason,r=e.status?0:1,o=0;o<t.length;o++)!function(t){var o=t[r],i=t[2];u(o,n,i,e.status)}(t[o]);t=[]}}function u(t,n,r,o){var i=r.resolve,u=r.reject;"function"==typeof t?e(function(){var e;try{e=t(n)}catch(e){return void u(e)}i(e)}):o?i(n):u(n)}var s=function(){};return r.defer=function(){var e=new r(s);return{promise:e,resolve:e.resolve,reject:e.reject}},r.resolve=function(e){return n(e)?e:new r(function(t,n){t(e)})},r.reject=function(e){return new r(function(t,n){n(e)})},Promise.prototype.toString=function(){return"[object Promise]"},r.prototype.then=function(e,t){var n=this.status,o=r.defer(),i=o.promise;return~n?n&&"function"==typeof e?u(e,this.value,i,n):n||"function"!=typeof t?n?o.resolve(this.value):o.reject(this.reason):u(t,this.reason,i,n):this._events.push([e,t,i]),i},r}},{}],5:[function(e,t,n){function r(e){return null!==e&&"object"==typeof e&&!e.nodeType&&e!==e.window&&!(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))}function o(e,t,n){function o(e){if("[Objece Array]"==Object.prototype.toString(n)){for(var t=!1,r=0;r<n.length;r++)if(n[r]==e){t=!0;break}if(!t)return!1}return!a||"function"!=typeof c[e]}function i(e,t){return"undefined"!=typeof t&&null!=t&&(t=+t>0?+t:0),function(n){var o,i=c.defer(),u=0,s=function(r){var s=n[r];c.resolve(s).then(function(n){o[r]=n,(0==--u||!e&&t&&o.length>=t)&&i.resolve(o)},function(e){"undefined"==typeof t?i.reject(e):0==--u&&i.resolve(o)}),u++};if("[object Array]"===Object.prototype.toString.call(n)){o=[];for(var f=0;f<n.length;f++)s(f)}else if(e&&r(n)){o={};for(var f in n)s(f)}else i.reject(new TypeError);return i.promise}}function u(e){for(var t=c.defer(),n=0;n<e.length;n++)+function(){var r=n,o=e[r];c.resolve(o).then(function(e){t.resolve(e)},function(e){t.reject(e)})}();return t.promise}function s(e){return function(t,n){return t?e.reject(t):void e.resolve(n)}}function f(e){var t=this===c?null:this,n=c.defer(),r=Array.prototype.slice.call(arguments,1);r.push(s(n)),e.apply(t,r)}var c,a;return t?(a=!0,c=t):c=e,c.Promise||e==t||(c.Promise=e),"function"==typeof e.defer?c.defer=e.defer:"function"==typeof e.deferred?c.defer=e.deferred:c.defer=function(){var t,n,r=new e(function(e,r){t=e,n=r});return{promise:r,resolve:t,reject:n}},o("delay")&&(c.delay=function(e,t){var n=c.defer();return setTimeout(n.resolve,e,t),n.promise}),o("resolve")&&(c.resolve=function(e){var t=c.defer();return t.resolve(e),t.promise}),o("reject")&&(c.reject=function(e){var t=c.defer();return t.reject(e),t.promise}),o("all")&&(c.all=i()),o("allMap")&&(c.allMap=i(!0)),o("some")&&(c.some=function(e,t){return i(!1,t||0)(e)}),o("map")&&(c.map=function(e,t,n){function r(){if(f<a.length){var n=a[f],s=c.resolve(t(e[n],n,e)).then(function(e){return r(),e},o.reject);i.push(s),u--,f++}else c.all(i).then(o.resolve,o.reject)}var o=c.defer(),i=[],u=n?+n.concurrency:0;if(0==u||u!=u){for(var s in e)i.push(t(e[s],s,e));return c.all(i).then(o.resolve,o.reject),o.promise}var f=0,a=function(){var t=[];for(var n in e)t.push(n);return t}();do r();while(u>0&&f<a.length);return o.promise}),o("race")&&(c.race=u),o("any")&&(c.any=u),o("nfcall")&&(c.nfcall=f),o("nfapply")&&(c.nfapply=function(e,t){var n=this===c?null:this,r=c.defer();if("[object Array]"!==Object.prototype.toString.call(t))throw"args TypeError";return t.push(s(r)),e.apply(n,t),r.promise}),c.denodeify=function(e){var t=this===c?null:this;return function(){return f.call(t,e,Array.prototype.slice.call(arguments))}},c}t.exports=o},{}]},{},[1]);