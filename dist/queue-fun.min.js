/*!
 * queue-fun v1.0.0
 * Homepage https://github.com/cnwhy/queue-fun
 * License BSD-2-Clause
 */
!function e(t,n,r){function i(u,s){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){!function(e,t){if("function"==typeof define&&(define.amd||define.cmd))define([],t);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("加载 "+e+" 模块失败！，请检查您的环境！");var n="undefined"!=typeof window?window:self;n[e]=t()}}("QueueFun",function(){return e("../lib/index.js")(e("easy-promise/setTimeout"))})},{"../lib/index.js":2,"easy-promise/setTimeout":4}],2:[function(e,t,n){"use strict";var r=e("extend-promise/src/extendClass"),i=e("./utils");t.exports=function(e){function t(e){y=u.Q=r(e,{})}function n(e){var t=+e>>0;if(t>0)return t;throw new Error('The "max" value is invalid')}function o(e){return y.resolve(1).then(function(){return e()})}function u(e,t){function r(){if(m<_&&!g&&y.length>0){var e,t=y.shift(),n=0,r=t._options.queue_event_onoff,i=+f("timeout",t,c),s=f("retry",t,c),p=f("retry_type",t,c),v=t._options.self,h=function(){return e&&clearTimeout(e),e=0,!!n++||void m--},d=function(){a.call(t,"event_item_finally",c,c,t)!==!1&&r&&l.call(c,"event_item_finally",c,t)},w=function(e){h()||(t.defer.resolve(e),a.call(t,"event_item_resolve",c,e,c,t)!==!1&&r&&l.call(c,"event_item_resolve",e,c,t),d())},b=function(e){h()||(s>t._errNo++?c._addItem(t,p,!0,!1):(t.defer.reject(e),a.call(t,"event_item_reject",c,e,c,t)!==!1&&r&&l.call(c,"event_item_reject",e,c,t)),d())};0!=m||j||(j=!0,l.call(c,"event_queue_begin",c));o(function(){return t.fn.apply(v||null,t.regs)}).then(w,b).then(function(){y.length>0?u():0==m&&j&&(j=!1,l.call(c,"event_queue_end",c))});return m+=1,void(i>0&&(e=setTimeout(function(){b("timeout")},i)))}return!0}function u(){for(;!r(););}var c=this,v={event_queue_begin:null,event_queue_end:null,event_queue_add:null,event_item_resolve:null,event_item_reject:null,event_item_finally:null,retry:0,retry_type:0,timeout:0},y=[],_=n(e),m=0,j=!1,g=0;if(this._options=v,this.onError=d,i.isObject(t))for(var w in t)v.hasOwnProperty(w)&&(v[w]=t[w]);this.getMax=function(){return _},this.setMax=function(e){try{_=n(e),!g&&m&&c.start()}catch(e){h.call(c,e)}},this.getQueueLength=function(){return y.length},this.getRunCount=function(){return m},this.isStart=function(){return!!j},this._addItem=function(e,t,n,r){if(!(e instanceof s))throw new TypeError('"unit" is not QueueUnit');t?y.unshift(e):y.push(e),r||p.call(c,e),n?c.start():j&&u()},this.start=function(){g=0,u()},this.stop=function(){g=1},this.clear=function(e){for(;y.length;){var t=y.shift();t.defer.reject(e)}}}function s(e,t,n){function r(e){for(var t=0;t<u.length;t++)if(e===u[t])return!0;return!1}var o={event_item_resolve:!0,event_item_reject:!0,event_item_finally:!0,queue_event_onoff:!0,regs:[],self:null},u=["event_item_resolve","event_item_reject","event_item_finally","queue_event_onoff","retry","retry_type","timeout","self"],s=1;if(!i.isFunction(e))throw new TypeError("Queues only support function, '"+e+"' is not function");this.fn=e,this._errNo=0,this.defer=y.defer(),i.isArray(t)&&(this.regs=t,s++),this._options=o;var f=arguments[s];if(i.isObject(f))for(var c in f)r(c)&&(o[c]=f[c])}function f(e,t,n){return e in t._options?t._options[e]:n._options[e]}function c(e,t,n){var r=t;if(!i.isFunction(e))return!!e;try{return e.apply(r,n)}catch(e){h.call(r,e)}}function l(e){var t=this._options[e],n=i.arg2arr(arguments,1);return c.call(null,t,this,n)}function a(e,t){var n=this._options[e],r=i.arg2arr(arguments,2);return c.call(null,n,t,r)}function p(e){l.call(this,"event_queue_add",e,this)}function v(e,t,n){return new s(e,t,n)}function h(e){i.isFunction(this.onError)&&this.onError.call(this,e)}var y;t(e);var d=function(e){try{console.error(e)}catch(e){}};return u.setPromise=t,u.prototype={option:function(e){return 1==arguments.length?this._options[e]:void(arguments.length>1&&(this._options[e]=arguments[1]))},push:function(){var e=this,t=v.apply(e,arguments);return e._addItem(t,!1),t.defer.promise},unshift:function(){var e=this,t=v.apply(e,arguments);return e._addItem(t,!0),t.defer.promise},go:function(){var e=this,t=v.apply(e,arguments);return e._addItem(t,!1,!0),t.defer.promise},jump:function(){var e=this,t=v.apply(e,arguments);return e._addItem(t,!0,!0),t.defer.promise},all:function(e,t,n){for(var r=[],i=this,o=0;o<e.length;o++)+function(){var t=o,u=e[t],s=n?i.unshift.apply(i,u):i.push.apply(i,u);r.push(s)}();var u=y.defer();return y.all(r).then(function(e){u.resolve(e)},function(e){u.reject(e)}),t&&this.start(),u.promise},allLike:function(e,t,n){var r,o,u,s=[],f=2,c=this;i.isObject(n)?(r=n,f++):n=null,o=arguments[f],u=arguments[++f];for(var l=0;l<e.length;l++)+function(){var r=l,i=[].concat([e[r]],[r],[e]),o=u?c.unshift(t,i,n):c.push(t,i,n);s.push(o)}();var a=y.defer();return y.all(s).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise},allEach:function(e,t,n){var r,o,u,s=[],f=2,c=this;i.isObject(n)?(r=n,f++):n=null,o=arguments[f],u=arguments[++f];for(var l in e)+function(){var r=l,i=[].concat([e[r]],[r],[e]),o=u?c.unshift(t,i,n):c.push(t,i,n);s.push(o)}();var a=y.defer();return y.all(s).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise},allMap:function(e,t,n){var r,o,u,s={},f=2,c=this;i.isObject(n)?(r=n,f++):n=null,o=arguments[f],u=arguments[++f];for(var l in e)+function(){var r=l,i=[].concat([e[r]],[r],[e]),o=u?c.unshift(t,i,n):c.push(t,i,n);s[r]=o}();var a=y.defer();return y.allMap(s).then(function(e){a.resolve(e)},function(e){a.reject(e)}),o&&this.start(),a.promise}},u.prototype.allArray=u.prototype.allLike,u}},{"./utils":3,"extend-promise/src/extendClass":6}],3:[function(e,t,n){"use strict";n.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"==typeof e},n.isObject=function(e){return"object"==typeof e&&null!==e},n.arg2arr=function(e,t,n){return Array.prototype.slice.call(e,t,n)}},{}],4:[function(e,t,n){t.exports=e("./src")(function(e){setTimeout(e,0)})},{"./src":5}],5:[function(e,t,n){"use strict";t.exports=function(e){function t(e,r){if(n(r))r.then(e.resolve,e.reject);else if(!r||"function"!=typeof r&&"object"!=typeof r)e.resolve(r);else{var i,o=!1;try{i=r.then,"function"==typeof i?i.call(r,function(n){o||(o=!0,t(e,n))},function(t){o||(o=!0,e.reject(t))}):e.resolve(r)}catch(t){o||(o=!0,e.reject(t))}}}function n(e){return e instanceof r}function r(e){function n(e){i.call(f,1,e)}function r(e){i.call(f,0,e)}function o(e){if(!c)return c=!0,f===e?r(new TypeError("The promise and its value refer to the same object")):void t({resolve:n,reject:r},e)}function u(e){c||(c=!0,r(e))}var f=this;this.status=-1,this._events=[];var c=!1;if(this.resolve=o,this.reject=u,e!==s&&"function"==typeof e)try{e(this.resolve,this.reject)}catch(e){this.reject(e)}}function i(e,t){var n=this;~this.status||(this.status=e,e?this.value=t:this.reason=t,o.call(n))}function o(){if(~this.status){for(var e=this,t=e._events,n=e.status?e.value:e.reason,r=e.status?0:1,i=0;i<t.length;i++)!function(t){var i=t[r],o=t[2];u(i,n,o,e.status)}(t[i]);t=[]}}function u(t,n,r,i){var o=r.resolve,u=r.reject;"function"==typeof t?e(function(){var e;try{e=t(n)}catch(e){return void u(e)}o(e)}):i?o(n):u(n)}var s=function(){};return r.defer=function(){var e=new r(s);return{promise:e,resolve:e.resolve,reject:e.reject}},r.resolve=function(e){return n(e)?e:new r(function(t,n){t(e)})},r.reject=function(e){return new r(function(t,n){n(e)})},Promise.prototype.toString=function(){return"[object Promise]"},r.prototype.then=function(e,t){var n=this.status,i=r.defer(),o=i.promise;return~n?n&&"function"==typeof e?u(e,this.value,o,n):n||"function"!=typeof t?n?i.resolve(this.value):i.reject(this.reason):u(t,this.reason,o,n):this._events.push([e,t,o]),o},r}},{}],6:[function(e,t,n){"use strict";function r(e,t,n){function r(e){if(o(n)){for(var t=!1,r=0;r<n.length;r++)if(n[r]==e){t=!0;break}if(!t)return!1}return!h||!s(v[e])}function i(e,t){return u(t)||(t=+t>0?+t:0),function(n){var r,i=v.defer(),s=0,c=function(o){var f=n[o];v.resolve(f).then(function(n){r[o]=n,(0==--s||!e&&t&&r.length>=t)&&i.resolve(r)},function(e){u(t)?i.reject(e):0==--s&&i.resolve(r)}),s++};if(o(n)){r=[];for(var l=0;l<n.length;l++)c(l)}else if(e&&f(n)){r={};for(var l in n)c(l)}else i.reject(new TypeError("参数错误"));return i.promise}}function l(e){for(var t=v.defer(),n=0;n<e.length;n++)+function(){var r=n,i=e[r];v.resolve(i).then(function(e){t.resolve(e)},function(e){t.reject(e)})}();return t.promise}function a(e){return function(t,n){return t?e.reject(t):void e.resolve(n)}}function p(e){var t=this===v?null:this,n=v.defer(),r=c(arguments,1);r.push(a(n)),e.apply(t,r)}var v,h;if(t?(h=!0,v=t):v=e,v.Promise||e==t||(v.Promise=e),s(e.prototype.then))v.defer=function(){var t,n,r=new e(function(e,r){t=e,n=r});return{promise:r,resolve:t,reject:n}};else if(s(e.defer))v.defer=function(){return e.defer()};else{if(!s(e.deferred))throw new TypeError("此类不支持扩展!");v.defer=function(){return e.deferred()}}return r("delay")&&(v.delay=function(e,t){var n=v.defer();return setTimeout(function(){n.resolve(t)},e),n.promise}),r("resolve")&&(v.resolve=function(e){var t=v.defer();return t.resolve(e),t.promise}),r("reject")&&(v.reject=function(e){var t=v.defer();return t.reject(e),t.promise}),r("all")&&(v.all=i()),r("allMap")&&(v.allMap=i(!0)),r("some")&&(v.some=function(e,t){return i(!1,t||0)(e)}),r("map")&&(v.map=function(e,t,n){function r(){if(f<c.length){var n=c[f],s=v.resolve(t(e[n],n,e)).then(function(e){return r(),e},i.reject);o.push(s),u--,f++}else v.all(o).then(i.resolve,i.reject)}var i=v.defer(),o=[],u=n?+n.concurrency:0;if(0==u||u!=u){for(var s in e)o.push(t(e[s],s,e));return v.all(o).then(i.resolve,i.reject),i.promise}var f=0,c=function(){var t=[];for(var n in e)t.push(n);return t}();do r();while(u>0&&f<c.length);return i.promise}),r("race")&&(v.race=l),r("any")&&(v.any=l),r("nfcall")&&(v.nfcall=p),r("nfapply")&&(v.nfapply=function(e,t){var n=this===v?null:this,r=v.defer();if(!o(t))throw TypeError('"args" is not Array');return t.push(a(r)),e.apply(n,t),r.promise}),v.denodeify=function(e){var t=this===v?null:this;return function(){return p.call(t,e,c(arguments))}},v}var i=e("./utils"),o=i.isArray,u=i.isEmpty,s=i.isFunction,f=i.isPlainObject,c=i.arg2arr;t.exports=r},{"./utils":7}],7:[function(e,t,n){"use strict";n.isPlainObject=function(e){return null!==e&&"object"==typeof e&&!e.nodeType&&e!==e.window&&!(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))},n.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"==typeof e},n.isEmpty=function(e){return"undefined"==typeof e||null===e},n.arg2arr=function(e,t,n){return Array.prototype.slice.call(e,t,n)}},{}]},{},[1]);