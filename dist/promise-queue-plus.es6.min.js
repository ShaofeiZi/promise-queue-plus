/*!
 * promise-queue-plus v1.1.0
 * Homepage https://github.com/cnwhy/promise-queue-plus
 * License BSD-2-Clause
 */
!function r(e,t,n){function o(u,s){if(!t[u]){if(!e[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=t[u]={exports:{}};e[u][0].call(a.exports,function(r){var t=e[u][1][r];return o(t||r)},a,a.exports,r,e,t,n)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<n.length;u++)o(n[u]);return o}({1:[function(r,e,t){!function(r,e){if("function"==typeof define&&(define.amd||define.cmd))define([],e);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error('Loading the "'+r+'" module failed!');("undefined"!=typeof window?window:self)[r]=e()}}("PromiseQueuePlus",function(){return r("../src/queue")(Promise)})},{"../src/queue":4}],2:[function(r,e,t){"use strict";function n(r,e,t){function n(r){if(i(t)){for(var e=!1,n=0;n<t.length;n++)if(t[n]==r){e=!0;break}if(!e)return!1}return!d||!s(h[r])}function o(r,e){return u(e)||(e=+e>0?+e:0),function(t){var n,o=h.defer(),s=0,a=function(i){var f=t[i];h.resolve(f).then(function(t){void 0!==e?n.push(t):n[i]=t,(0==--s||!r&&e&&n.length>=e)&&o.resolve(n)},function(r){u(e)?o.reject(r):0==--s&&o.resolve(n)}),s++};if(i(t)){n=[],0==t.length&&o.resolve(n);for(var c=0;c<t.length;c++)a(c)}else if(r&&f(t)){var l=0;n={};for(var c in t)a(c),l++;0==l&&o.resolve(n)}else o.reject(new TypeError("参数错误"));return o.promise}}function c(r){for(var e=h.defer(),t=0;t<r.length;t++)!function(){var n=t,o=r[n];h.resolve(o).then(function(r){e.resolve(r)},function(r){e.reject(r)})}();return e.promise}function l(r){return function(e,t){if(e)return r.reject(e);r.resolve(t)}}function p(r){var e=this===h?null:this,t=h.defer(),n=a(arguments,1);return n.push(l(t)),r.apply(e,n),t.promise}var h,d;if(e?(d=!0,h=e):h=r,h.Promise||r==e||(h.Promise=r),s(r)&&s(r.prototype.then))h.defer=function(){var e,t;return{promise:new r(function(r,n){e=r,t=n}),resolve:e,reject:t}};else if(s(r.defer))h.defer=function(){return r.defer()};else{if(!s(r.deferred))throw new TypeError("此类不支持扩展!");h.defer=function(){return r.deferred()}}return n("delay")&&(h.delay=function(r,e){var t=h.defer();return setTimeout(function(){t.resolve(e)},r),t.promise}),n("resolve")&&(h.resolve=function(r){var e=h.defer();return e.resolve(r),e.promise}),n("reject")&&(h.reject=function(r){var e=h.defer();return e.reject(r),e.promise}),n("all")&&(h.all=o()),n("allMap")&&(h.allMap=o(!0)),n("some")&&(h.some=function(r,e){return e=+e>=0?+e:0,o(!1,e)(r)}),n("map")&&(h.map=function(r,e,t){function n(){if(f<a.length){var t=a[f],s=h.resolve(e(r[t],t,r)).then(function(r){return n(),r},o.reject);i.push(s),u--,f++}else h.all(i).then(o.resolve,o.reject)}var o=h.defer(),i=[],u=t?+t.concurrency:0;if(0==u||u!=u){for(var s in r)i.push(e(r[s],s,r));return h.all(i).then(o.resolve,o.reject),o.promise}var f=0,a=function(){var e=[];for(var t in r)e.push(t);return e}();do{n()}while(u>0&&f<a.length);return o.promise}),n("race")&&(h.race=c),n("any")&&(h.any=c),n("nfcall")&&(h.nfcall=p),n("nfapply")&&(h.nfapply=function(r,e){var t=this===h?null:this,n=h.defer();if(!i(e))throw TypeError('"args" is not Array');return e.push(l(n)),r.apply(t,e),n.promise}),h.denodeify=function(r){var e=this===h?null:this;return function(){return p.apply(e,[].concat([r],a(arguments)))}},h}var o=r("./utils"),i=o.isArray,u=o.isEmpty,s=o.isFunction,f=o.isPlainObject,a=o.arg2arr;e.exports=n},{"./utils":3}],3:[function(r,e,t){"use strict";t.isPlainObject=function(r){return null!==r&&"object"==typeof r&&!r.nodeType&&r!==r.window&&!(r.constructor&&!Object.prototype.hasOwnProperty.call(r.constructor.prototype,"isPrototypeOf"))},t.isArray=function(r){return"[object Array]"==Object.prototype.toString.call(r)},t.isFunction=function(r){return"function"==typeof r},t.isEmpty=function(r){return void 0===r||null===r},t.arg2arr=function(r,e,t){return Array.prototype.slice.call(r,e,t)}},{}],4:[function(r,e,t){function n(r){function e(r){y=t.Q=t.Promise=o.extendPromise(r)}function t(r,e){function t(){if(y<d&&!w&&h.length>0){var r,e=h.shift(),t=0,o=+u("timeout",e,c),i=u("retry",e,c),a=u("retryIsJump",e,c),l=e._options.self,p=function(){if(r&&clearTimeout(r),r=0,t++)return!0;y--},v=function(){f(e,c,"workFinally",c,c,e)},j=function(r){p()||(e.defer.resolve(r),f(e,c,"workResolve",c,r,c,e),v())},A=function(r){p()||(i>e._errNo++?c._addItem(e,a,!0,!1):(e.defer.reject(r),f(e,c,"workReject",c,r,c,e)),v())};0!=y||g||(g=!0,s.call(c,"queueStart",c,c));m(function(){return e.fn.apply(l||null,e.regs)}).then(j,A).then(function(){h.length>0?n():0==y&&g&&(g=!1,s.call(c,"queueEnd",c,c))});return y+=1,void(o>0&&(r=setTimeout(function(){A("timeout")},o)))}return!0}function n(){for(;!t(););}var c=this,p={queueStart:null,queueEnd:null,workAdd:null,workResolve:null,workReject:null,workFinally:null,retry:0,retryIsJump:!1,timeout:0},h=[],d=o.getPositiveInt(r),y=0,g=!1,w=0;if(this._options=p,this.onError=v,o.isObject(e))for(var j in e)p.hasOwnProperty(j)&&(p[j]=e[j]);this.getMax=function(){return d},this.setMax=function(r){try{d=o.getPositiveInt(r),!w&&y&&c.start()}catch(r){l.call(c,r)}},this.getLength=function(){return h.length},this.getRunCount=function(){return y},this.isStart=function(){return!!g},this._addItem=function(r,e,t,o){if(!(r instanceof i))throw new TypeError('"unit" is not QueueUnit');e?h.unshift(r):h.push(r),o||a.call(c,r),t?c.start():g&&n()},this.start=function(){w=0,n()},this.stop=function(){w=1},this.clear=function(r){for(;h.length;){h.shift().defer.reject(r)}}}function i(r,e,t){var n={workResolve:!0,workReject:!0,workFinally:!0,queueEventTrigger:!0,regs:[],self:null},i=["workResolve","workReject","workFinally","queueEventTrigger","retry","retryIsJump","timeout","self"],u=1;if(!o.isFunction(r))throw new TypeError("Queues only support function, '"+r+"' is not function");this.fn=r,this._errNo=0,this.defer=y.defer(),o.isArray(e)&&(this.regs=e,u++),this._options=n;var s=arguments[u];if(o.isObject(s))for(var f in s)(function(r){for(var e=0;e<i.length;e++)if(r===i[e])return!0;return!1})(f)&&(n[f]=s[f])}function u(r,e,t){return r in e._options?e._options[r]:t._options[r]}function s(r,e){var t=this._options[r],n=o.arg2arr(arguments,2);if(!o.isFunction(t))return!!t;try{return t.apply(e,n)}catch(r){l.call(e,r)}}function f(r,e){var t=r._options.queueEventTrigger,n=o.arg2arr(arguments,2);!1!==s.apply(r,n)&&t&&s.apply(e,n)}function a(r){s.call(this,"workAdd",this,r,this)}function c(r,e,t){return new i(r,e,t)}function l(r){o.isFunction(this.onError)&&this.onError.call(this,r)}function p(r,e,t,n){function i(i){var u=n?o.toArray([r[i]],[i],[r]):o.toArray(r[i]);s[i]=[e,u,t]}var u=o.isArray(r),s=u?[]:{};if(u)for(var f=0;f<r.length;f++)i(f);else for(var a in r)i(a);return s}function h(r,e,t){var n,i=2;return o.isObject(t)&&(n=t,i++),{con:n,start:arguments[i],jump:arguments[++i]}}function d(r,e){var t,n=this.queue,o=this.map,i=this.each,u=h.apply(null,arguments);return t=p(r,e,u.con,i),o?n.addProps(t,u.start,u.jump):n.addArray(t,u.start,u.jump)}var y;e(r);var v=function(r){console.error(r)},m=function(r){return o.runFn2Promise(y,r)};return t.prototype={option:function(r){if(1==arguments.length)return this._options[r];arguments.length>1&&(this._options[r]=arguments[1])},push:function(){var r=this,e=c.apply(r,arguments);return r._addItem(e,!1),e.defer.promise},unshift:function(){var r=this,e=c.apply(r,arguments);return r._addItem(e,!0),e.defer.promise},go:function(){var r=this,e=c.apply(r,arguments);return r._addItem(e,!1,!0),e.defer.promise},jump:function(){var r=this,e=c.apply(r,arguments);return r._addItem(e,!0,!0),e.defer.promise},add:function(r,e){var t,n,i,u,s,f=this,a=1;if(!o.isFunction(r))throw new TypeError("Queues only support function, '"+r+"' is not function");return t=function(){var e=y.defer();return r(e.resolve,e.reject),e.promise},n=[t],o.isObject(e)&&(n.push(e),a++),i=!!arguments[a],u=!!arguments[a+1],s=u?f.unshift.apply(f,n):f.push.apply(f,n),i&&f.start(),s},addArray:function(r,e,t){for(var n=[],i=this,u=0;u<r.length;u++)+function(){var e=u,s=o.toArray(r[e]),f=t?i.unshift.apply(i,s):i.push.apply(i,s);n.push(f)}();var s=y.defer();return y.all(n).then(function(r){s.resolve(r)},function(r){s.reject(r)}),e&&i.start(),s.promise},addProps:function(r,e,t){var n={},i=this;for(var u in r)+function(){var e=u,s=o.toArray(r[e]),f=t?i.unshift.apply(i,s):i.push.apply(i,s);n[e]=f}();var s=y.defer();return y.allMap(n).then(function(r){s.resolve(r)},function(r){s.reject(r)}),e&&i.start(),s.promise},addLikeArray:function(r,e,t){return d.apply({queue:this},arguments)},addLikeProps:function(r,e,t){return d.apply({queue:this,map:!0},arguments)},addLikeArrayEach:function(r,e,t){return d.apply({queue:this,each:!0},arguments)},addLikePropsEach:function(r,e,t){return d.apply({queue:this,each:!0,map:!0},arguments)}},t.use=e,t.createUse=n,t}var o=r("./utils");e.exports=n},{"./utils":5}],5:[function(r,e,t){var n=r("extend-promise/src/extendClass");t.isArray=function(r){return"[object Array]"==Object.prototype.toString.call(r)},t.isFunction=function(r){return"function"==typeof r},t.isObject=function(r){return"object"==typeof r&&null!==r},t.arg2arr=function(r,e,t){return Array.prototype.slice.call(r,e,t)},t.toArray=function(){return Array.prototype.concat.apply([],arguments)},t.getPositiveInt=function(r){var e=+r>>0;if(e>=1)return e;throw new Error('The "max" value is invalid')},t.extendPromise=function(r){return n(r,{})},t.runFn2Promise=function(r,e){try{return r.resolve(e())}catch(e){return r.reject(e)}}},{"extend-promise/src/extendClass":2}]},{},[1]);