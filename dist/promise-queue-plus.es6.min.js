/*!
 * promise-queue-plus v1.0.0
 * Homepage https://github.com/cnwhy/promise-queue-plus
 * License BSD-2-Clause
 */
!function e(r,t,n){function o(u,s){if(!t[u]){if(!r[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=t[u]={exports:{}};r[u][0].call(c.exports,function(e){var t=r[u][1][e];return o(t?t:e)},c,c.exports,e,r,t,n)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<n.length;u++)o(n[u]);return o}({1:[function(e,r,t){!function(e,r){if("function"==typeof define&&(define.amd||define.cmd))define([],r);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error('Loading the "'+e+'" module failed!');var t="undefined"!=typeof window?window:self;t[e]=r()}}("PromiseQueuePlus",function(){return e("../src/queue")(Promise)})},{"../src/queue":4}],2:[function(e,r,t){"use strict";function n(e,r,t){function n(e){if(i(t)){for(var r=!1,n=0;n<t.length;n++)if(t[n]==e){r=!0;break}if(!r)return!1}return!d||!s(h[e])}function o(e,r){return u(r)||(r=+r>0?+r:0),function(t){var n,o=h.defer(),s=0,c=function(i){var f=t[i];h.resolve(f).then(function(t){"undefined"!=typeof r?n.push(t):n[i]=t,(0==--s||!e&&r&&n.length>=r)&&o.resolve(n)},function(e){u(r)?o.reject(e):0==--s&&o.resolve(n)}),s++};if(i(t)){n=[],0==t.length&&o.resolve(n);for(var a=0;a<t.length;a++)c(a)}else if(e&&f(t)){var l=0;n={};for(var a in t)c(a),l++;0==l&&o.resolve(n)}else o.reject(new TypeError("参数错误"));return o.promise}}function a(e){for(var r=h.defer(),t=0;t<e.length;t++)!function(){var n=t,o=e[n];h.resolve(o).then(function(e){r.resolve(e)},function(e){r.reject(e)})}();return r.promise}function l(e){return function(r,t){return r?e.reject(r):void e.resolve(t)}}function p(e){var r=this===h?null:this,t=h.defer(),n=c(arguments,1);return n.push(l(t)),e.apply(r,n),t.promise}var h,d;if(r?(d=!0,h=r):h=e,h.Promise||e==r||(h.Promise=e),s(e)&&s(e.prototype.then))h.defer=function(){var r,t,n=new e(function(e,n){r=e,t=n});return{promise:n,resolve:r,reject:t}};else if(s(e.defer))h.defer=function(){return e.defer()};else{if(!s(e.deferred))throw new TypeError("此类不支持扩展!");h.defer=function(){return e.deferred()}}return n("delay")&&(h.delay=function(e,r){var t=h.defer();return setTimeout(function(){t.resolve(r)},e),t.promise}),n("resolve")&&(h.resolve=function(e){var r=h.defer();return r.resolve(e),r.promise}),n("reject")&&(h.reject=function(e){var r=h.defer();return r.reject(e),r.promise}),n("all")&&(h.all=o()),n("allMap")&&(h.allMap=o(!0)),n("some")&&(h.some=function(e,r){return r=+r>=0?+r:0,o(!1,r)(e)}),n("map")&&(h.map=function(e,r,t){function n(){if(f<c.length){var t=c[f],s=h.resolve(r(e[t],t,e)).then(function(e){return n(),e},o.reject);i.push(s),u--,f++}else h.all(i).then(o.resolve,o.reject)}var o=h.defer(),i=[],u=t?+t.concurrency:0;if(0==u||u!=u){for(var s in e)i.push(r(e[s],s,e));return h.all(i).then(o.resolve,o.reject),o.promise}var f=0,c=function(){var r=[];for(var t in e)r.push(t);return r}();do n();while(u>0&&f<c.length);return o.promise}),n("race")&&(h.race=a),n("any")&&(h.any=a),n("nfcall")&&(h.nfcall=p),n("nfapply")&&(h.nfapply=function(e,r){var t=this===h?null:this,n=h.defer();if(!i(r))throw TypeError('"args" is not Array');return r.push(l(n)),e.apply(t,r),n.promise}),h.denodeify=function(e){var r=this===h?null:this;return function(){return p.apply(r,[].concat([e],c(arguments)))}},h}var o=e("./utils"),i=o.isArray,u=o.isEmpty,s=o.isFunction,f=o.isPlainObject,c=o.arg2arr;r.exports=n},{"./utils":3}],3:[function(e,r,t){"use strict";t.isPlainObject=function(e){return null!==e&&"object"==typeof e&&!e.nodeType&&e!==e.window&&!(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))},t.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},t.isFunction=function(e){return"function"==typeof e},t.isEmpty=function(e){return"undefined"==typeof e||null===e},t.arg2arr=function(e,r,t){return Array.prototype.slice.call(e,r,t)}},{}],4:[function(e,r,t){"use strict";function n(e){function r(e){g=s.Q=s.Promise=o(e,{})}function t(e){var r=+e>>0;if(r>0)return r;throw new Error('The "max" value is invalid')}function u(e){try{return g.resolve(e())}catch(e){return g.reject(e)}}function s(e,r){function n(){if(m<y&&!j&&v.length>0){var e,r=v.shift(),t=0,n=+c("timeout",r,s),i=c("retry",r,s),f=c("retryIsJump",r,s),p=r._options.self,h=function(){return e&&clearTimeout(e),e=0,!!t++||void m--},d=function(){l(r,s,"workFinally",s,s,r)},w=function(e){h()||(r.defer.resolve(e),l(r,s,"workResolve",s,e,s,r),d())},_=function(e){h()||(i>r._errNo++?s._addItem(r,f,!0,!1):(r.defer.reject(e),l(r,s,"workReject",s,e,s,r)),d())};0!=m||g||(g=!0,a.call(s,"queueStart",s,s));u(function(){return r.fn.apply(p||null,r.regs)}).then(w,_).then(function(){v.length>0?o():0==m&&g&&(g=!1,a.call(s,"queueEnd",s,s))});return m+=1,void(n>0&&(e=setTimeout(function(){_("timeout")},n)))}return!0}function o(){for(;!n(););}var s=this,h={event_queue_begin:null,event_queue_end:null,event_queue_add:null,event_item_resolve:null,event_item_reject:null,event_item_finally:null,retry:0,retry_type:0,timeout:0},h={queueStart:null,queueEnd:null,workAdd:null,workResolve:null,workReject:null,workFinally:null,retry:0,retryIsJump:!1,timeout:0},v=[],y=t(e),m=0,g=!1,j=0;if(this._options=h,this.onError=w,i.isObject(r))for(var _ in r)h.hasOwnProperty(_)&&(h[_]=r[_]);this.getMax=function(){return y},this.setMax=function(e){try{y=t(e),!j&&m&&s.start()}catch(e){d.call(s,e)}},this.getLength=function(){return v.length},this.getRunCount=function(){return m},this.isStart=function(){return!!g},this._addItem=function(e,r,t,n){if(!(e instanceof f))throw new TypeError('"unit" is not QueueUnit');r?v.unshift(e):v.push(e),n||p.call(s,e),t?s.start():g&&o()},this.start=function(){j=0,o()},this.stop=function(){j=1},this.clear=function(e){for(;v.length;){var r=v.shift();r.defer.reject(e)}}}function f(e,r,t){function n(e){for(var r=0;r<u.length;r++)if(e===u[r])return!0;return!1}var o={workResolve:!0,workReject:!0,workFinally:!0,queueEventTrigger:!0,regs:[],self:null},u=["workResolve","workReject","workFinally","queueEventTrigger","retry","retryIsJump","timeout","self"],s=1;if(!i.isFunction(e))throw new TypeError("Queues only support function, '"+e+"' is not function");this.fn=e,this._errNo=0,this.defer=g.defer(),i.isArray(r)&&(this.regs=r,s++),this._options=o;var f=arguments[s];if(i.isObject(f))for(var c in f)n(c)&&(o[c]=f[c])}function c(e,r,t){return e in r._options?r._options[e]:t._options[e]}function a(e,r){var t=this._options[e],n=i.arg2arr(arguments,2);if(!i.isFunction(t))return!!t;try{return t.apply(r,n)}catch(e){d.call(r,e)}}function l(e,r){var t=e._options.queueEventTrigger,n=i.arg2arr(arguments,2);a.apply(e,n)!==!1&&t&&a.apply(r,n)}function p(e){a.call(this,"workAdd",this,e,this)}function h(e,r,t){return new f(e,r,t)}function d(e){i.isFunction(this.onError)&&this.onError.call(this,e)}function v(e,r,t,n){function o(o){var i=n?[].concat([e[o]],[o],[e]):[].concat(e[o]);s[o]=[r,i,t]}var u=i.isArray(e),s=u?[]:{};if(u)for(var f=0;f<e.length;f++)o(f);else for(var c in e)o(c);return s}function y(e,r,t){var n,o=2;return i.isObject(t)&&(n=t,o++),{con:n,start:arguments[o],jump:arguments[++o]}}function m(e,r){var t,n=this.queue,o=this.map,i=this.each,u=y.apply(null,arguments);return t=v(e,r,u.con,i),o?n.addProps(t,u.start,u.jump):n.addArray(t,u.start,u.jump)}var g;r(e);var w=function(e){try{console.error(e)}catch(e){}};return s.prototype={option:function(e){return 1==arguments.length?this._options[e]:void(arguments.length>1&&(this._options[e]=arguments[1]))},push:function(){var e=this,r=h.apply(e,arguments);return e._addItem(r,!1),r.defer.promise},unshift:function(){var e=this,r=h.apply(e,arguments);return e._addItem(r,!0),r.defer.promise},go:function(){var e=this,r=h.apply(e,arguments);return e._addItem(r,!1,!0),r.defer.promise},jump:function(){var e=this,r=h.apply(e,arguments);return e._addItem(r,!0,!0),r.defer.promise},addArray:function(e,r,t){for(var n=[],o=this,i=0;i<e.length;i++)+function(){var r=i,u=e[r],s=t?o.unshift.apply(o,u):o.push.apply(o,u);n.push(s)}();var u=g.defer();return g.all(n).then(function(e){u.resolve(e)},function(e){u.reject(e)}),r&&this.start(),u.promise},addProps:function(e,r,t){var n={},o=this;for(var i in e)+function(){var r=i,u=e[r],s=t?o.unshift.apply(o,u):o.push.apply(o,u);n[r]=s}();var u=g.defer();return g.allMap(n).then(function(e){u.resolve(e)},function(e){u.reject(e)}),r&&this.start(),u.promise},addLikeArray:function(e,r,t){return m.apply({queue:this},arguments)},addLikeProps:function(e,r,t){return m.apply({queue:this,map:!0},arguments)},addLikeArrayEach:function(e,r,t){return m.apply({queue:this,each:!0},arguments)},addLikePropsEach:function(e,r,t){return m.apply({queue:this,each:!0,map:!0},arguments)}},s.use=r,s.createUse=n,s}var o=e("extend-promise/src/extendClass"),i=e("./utils");r.exports=n},{"./utils":5,"extend-promise/src/extendClass":2}],5:[function(e,r,t){"use strict";t.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},t.isFunction=function(e){return"function"==typeof e},t.isObject=function(e){return"object"==typeof e&&null!==e},t.arg2arr=function(e,r,t){return Array.prototype.slice.call(e,r,t)}},{}]},{},[1]);