/*!
 * promise-queue-plus v1.0.0-alpha.1
 * Homepage https://github.com/cnwhy/promise-queue-plus
 * License BSD-2-Clause
 */
!function e(t,r,n){function i(u,f){if(!r[u]){if(!t[u]){var s="function"==typeof require&&require;if(!f&&s)return s(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=r[u]={exports:{}};t[u][0].call(c.exports,function(e){var r=t[u][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[u].exports}for(var o="function"==typeof require&&require,u=0;u<n.length;u++)i(n[u]);return i}({1:[function(e,t,r){!function(e,t){if("function"==typeof define&&(define.amd||define.cmd))define([],t);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error('Loading the "'+e+'" module failed!');var r="undefined"!=typeof window?window:self;r[e]=t()}}("PromiseQueuePlus",function(){return e("../src/queue")(Promise)})},{"../src/queue":4}],2:[function(e,t,r){"use strict";function n(e,t,r){function n(e){if(o(r)){for(var t=!1,n=0;n<r.length;n++)if(r[n]==e){t=!0;break}if(!t)return!1}return!v||!f(h[e])}function i(e,t){return u(t)||(t=+t>0?+t:0),function(r){var n,i=h.defer(),f=0,c=function(o){var s=r[o];h.resolve(s).then(function(r){n[o]=r,(0==--f||!e&&t&&n.length>=t)&&i.resolve(n)},function(e){u(t)?i.reject(e):0==--f&&i.resolve(n)}),f++};if(o(r)){n=[];for(var a=0;a<r.length;a++)c(a)}else if(e&&s(r)){n={};for(var a in r)c(a)}else i.reject(new TypeError("参数错误"));return i.promise}}function a(e){for(var t=h.defer(),r=0;r<e.length;r++)+function(){var n=r,i=e[n];h.resolve(i).then(function(e){t.resolve(e)},function(e){t.reject(e)})}();return t.promise}function l(e){return function(t,r){return t?e.reject(t):void e.resolve(r)}}function p(e){var t=this===h?null:this,r=h.defer(),n=c(arguments,1);n.push(l(r)),e.apply(t,n)}var h,v;if(t?(v=!0,h=t):h=e,h.Promise||e==t||(h.Promise=e),f(e)&&f(e.prototype.then))h.defer=function(){var t,r,n=new e(function(e,n){t=e,r=n});return{promise:n,resolve:t,reject:r}};else if(f(e.defer))h.defer=function(){return e.defer()};else{if(!f(e.deferred))throw new TypeError("此类不支持扩展!");h.defer=function(){return e.deferred()}}return n("delay")&&(h.delay=function(e,t){var r=h.defer();return setTimeout(function(){r.resolve(t)},e),r.promise}),n("resolve")&&(h.resolve=function(e){var t=h.defer();return t.resolve(e),t.promise}),n("reject")&&(h.reject=function(e){var t=h.defer();return t.reject(e),t.promise}),n("all")&&(h.all=i()),n("allMap")&&(h.allMap=i(!0)),n("some")&&(h.some=function(e,t){return i(!1,t||0)(e)}),n("map")&&(h.map=function(e,t,r){function n(){if(s<c.length){var r=c[s],f=h.resolve(t(e[r],r,e)).then(function(e){return n(),e},i.reject);o.push(f),u--,s++}else h.all(o).then(i.resolve,i.reject)}var i=h.defer(),o=[],u=r?+r.concurrency:0;if(0==u||u!=u){for(var f in e)o.push(t(e[f],f,e));return h.all(o).then(i.resolve,i.reject),i.promise}var s=0,c=function(){var t=[];for(var r in e)t.push(r);return t}();do n();while(u>0&&s<c.length);return i.promise}),n("race")&&(h.race=a),n("any")&&(h.any=a),n("nfcall")&&(h.nfcall=p),n("nfapply")&&(h.nfapply=function(e,t){var r=this===h?null:this,n=h.defer();if(!o(t))throw TypeError('"args" is not Array');return t.push(l(n)),e.apply(r,t),n.promise}),h.denodeify=function(e){var t=this===h?null:this;return function(){return p.call(t,e,c(arguments))}},h}var i=e("./utils"),o=i.isArray,u=i.isEmpty,f=i.isFunction,s=i.isPlainObject,c=i.arg2arr;t.exports=n},{"./utils":3}],3:[function(e,t,r){"use strict";r.isPlainObject=function(e){return null!==e&&"object"==typeof e&&!e.nodeType&&e!==e.window&&!(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))},r.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isEmpty=function(e){return"undefined"==typeof e||null===e},r.arg2arr=function(e,t,r){return Array.prototype.slice.call(e,t,r)}},{}],4:[function(e,t,r){"use strict";function n(e){function t(e){_=f.Q=f.Promise=i(e,{})}function r(e){var t=+e>>0;if(t>0)return t;throw new Error('The "max" value is invalid')}function u(e){try{return _.resolve(e())}catch(e){return _.reject(e)}}function f(e,t){function n(){if(m<y&&!g&&d.length>0){var e,t=d.shift(),r=0,n=+c("timeout",t,f),o=c("retry",t,f),s=c("retry_type",t,f),p=t._options.self,h=function(){return e&&clearTimeout(e),e=0,!!r++||void m--},v=function(){l(t,f,"event_item_finally",f,f,t)},j=function(e){h()||(t.defer.resolve(e),l(t,f,"event_item_resolve",f,e,f,t),v())},w=function(e){h()||(o>t._errNo++?f._addItem(t,s,!0,!1):(t.defer.reject(e),l(t,f,"event_item_reject",f,e,f,t)),v())};0!=m||_||(_=!0,a.call(f,"event_queue_begin",f,f));u(function(){return t.fn.apply(p||null,t.regs)}).then(j,w).then(function(){d.length>0?i():0==m&&_&&(_=!1,a.call(f,"event_queue_end",f,f))});return m+=1,void(n>0&&(e=setTimeout(function(){w("timeout")},n)))}return!0}function i(){for(;!n(););}var f=this,h={event_queue_begin:null,event_queue_end:null,event_queue_add:null,event_item_resolve:null,event_item_reject:null,event_item_finally:null,retry:0,retry_type:0,timeout:0},d=[],y=r(e),m=0,_=!1,g=0;if(this._options=h,this.onError=j,o.isObject(t))for(var w in t)h.hasOwnProperty(w)&&(h[w]=t[w]);this.getMax=function(){return y},this.setMax=function(e){try{y=r(e),!g&&m&&f.start()}catch(e){v.call(f,e)}},this.getLength=function(){return d.length},this.getRunCount=function(){return m},this.isStart=function(){return!!_},this._addItem=function(e,t,r,n){if(!(e instanceof s))throw new TypeError('"unit" is not QueueUnit');t?d.unshift(e):d.push(e),n||p.call(f,e),r?f.start():_&&i()},this.start=function(){g=0,i()},this.stop=function(){g=1},this.clear=function(e){for(;d.length;){var t=d.shift();t.defer.reject(e)}}}function s(e,t,r){function n(e){for(var t=0;t<u.length;t++)if(e===u[t])return!0;return!1}var i={event_item_resolve:!0,event_item_reject:!0,event_item_finally:!0,queue_event_onoff:!0,regs:[],self:null},u=["event_item_resolve","event_item_reject","event_item_finally","queue_event_onoff","retry","retry_type","timeout","self"],f=1;if(!o.isFunction(e))throw new TypeError("Queues only support function, '"+e+"' is not function");this.fn=e,this._errNo=0,this.defer=_.defer(),o.isArray(t)&&(this.regs=t,f++),this._options=i;var s=arguments[f];if(o.isObject(s))for(var c in s)n(c)&&(i[c]=s[c])}function c(e,t,r){return e in t._options?t._options[e]:r._options[e]}function a(e,t){var r=this._options[e],n=o.arg2arr(arguments,2);if(!o.isFunction(r))return!!r;try{return r.apply(t,n)}catch(e){v.call(t,e)}}function l(e,t){var r=e._options.queue_event_onoff,n=o.arg2arr(arguments,2);a.apply(e,n)!==!1&&r&&a.apply(t,n)}function p(e){a.call(this,"event_queue_add",this,e,this)}function h(e,t,r){return new s(e,t,r)}function v(e){o.isFunction(this.onError)&&this.onError.call(this,e)}function d(e,t,r,n){function i(i){var o=n?[].concat([e[i]],[i],[e]):[].concat(e[i]);f[i]=[t,o,r]}var u=o.isArray(e),f=u?[]:{};if(u)for(var s=0;s<e.length;s++)i(s);else for(var c in e)i(c);return f}function y(e,t,r){var n,i=2;return o.isObject(r)&&(n=r,i++),{con:n,start:arguments[i],jump:arguments[++i]}}function m(e,t){var r,n=this.queue,i=this.map,o=this.each,u=y.apply(null,arguments);return r=d(e,t,u.con,o),i?n.addProps(r,u.start,u.jump):n.addArray(r,u.start,u.jump)}var _;t(e);var j=function(e){try{console.error(e)}catch(e){}};return f.prototype={option:function(e){return 1==arguments.length?this._options[e]:void(arguments.length>1&&(this._options[e]=arguments[1]))},push:function(){var e=this,t=h.apply(e,arguments);return e._addItem(t,!1),t.defer.promise},unshift:function(){var e=this,t=h.apply(e,arguments);return e._addItem(t,!0),t.defer.promise},go:function(){var e=this,t=h.apply(e,arguments);return e._addItem(t,!1,!0),t.defer.promise},jump:function(){var e=this,t=h.apply(e,arguments);return e._addItem(t,!0,!0),t.defer.promise},addArray:function(e,t,r){for(var n=[],i=this,o=0;o<e.length;o++)+function(){var t=o,u=e[t],f=r?i.unshift.apply(i,u):i.push.apply(i,u);n.push(f)}();var u=_.defer();return _.all(n).then(function(e){u.resolve(e)},function(e){u.reject(e)}),t&&this.start(),u.promise},addProps:function(e,t,r){var n={},i=this;for(var o in e)+function(){var t=o,u=e[t],f=r?i.unshift.apply(i,u):i.push.apply(i,u);n[t]=f}();var u=_.defer();return _.allMap(n).then(function(e){u.resolve(e)},function(e){u.reject(e)}),t&&this.start(),u.promise},addLikeArray:function(e,t,r){return m.apply({queue:this},arguments)},addLikeProps:function(e,t,r){return m.apply({queue:this,map:!0},arguments)},addLikeArrayEach:function(e,t,r){return m.apply({queue:this,each:!0},arguments)},addLikePropsEach:function(e,t,r){return m.apply({queue:this,each:!0,map:!0},arguments)}},f.use=t,f.createUse=n,f}var i=e("extend-promise/src/extendClass"),o=e("./utils");t.exports=n},{"./utils":5,"extend-promise/src/extendClass":2}],5:[function(e,t,r){"use strict";r.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isObject=function(e){return"object"==typeof e&&null!==e},r.arg2arr=function(e,t,r){return Array.prototype.slice.call(e,t,r)}},{}]},{},[1]);