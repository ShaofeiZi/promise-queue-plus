/*!
 * promise-queue-plus v1.1.0
 * Homepage https://github.com/cnwhy/promise-queue-plus
 * License BSD-2-Clause
 */
!function e(t,r,n){function o(u,s){if(!r[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=r[u]={exports:{}};t[u][0].call(c.exports,function(e){var r=t[u][1][e];return o(r||e)},c,c.exports,e,t,r,n)}return r[u].exports}for(var i="function"==typeof require&&require,u=0;u<n.length;u++)o(n[u]);return o}({1:[function(e,t,r){!function(e,t){if("function"==typeof define&&(define.amd||define.cmd))define([],t);else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error('Loading the "'+e+'" module failed!');("undefined"!=typeof window?window:self)[e]=t()}}("PromiseQueuePlus",function(){return e("../src/queue")(e("easy-promise/setTimeout"))})},{"../src/queue":6,"easy-promise/setTimeout":2}],2:[function(e,t,r){t.exports=e("./src")(function(e){setTimeout(e,0)})},{"./src":3}],3:[function(e,t,r){"use strict";t.exports=function(e){function t(e,n){if(r(n))n.then(e.resolve,e.reject);else if(!n||"function"!=typeof n&&"object"!=typeof n)e.resolve(n);else{var o,i=!1;try{o=n.then,"function"==typeof o?o.call(n,function(r){i||(i=!0,t(e,r))},function(t){i||(i=!0,e.reject(t))}):e.resolve(n)}catch(t){i||(i=!0,e.reject(t))}}}function r(e){return e instanceof n}function n(e){function r(e){o.call(f,1,e)}function n(e){o.call(f,0,e)}function i(e){if(!c){if(c=!0,f===e)return n(new TypeError("The promise and its value refer to the same object"));t({resolve:r,reject:n},e)}}function u(e){c||(c=!0,n(e))}var f=this;this.status=-1,this._events=[];var c=!1;if(this.resolve=i,this.reject=u,e!==s&&"function"==typeof e)try{e(this.resolve,this.reject)}catch(e){this.reject(e)}}function o(e,t){var r=this;~this.status||(this.status=e,e?this.value=t:this.reason=t,i.call(r))}function i(){if(~this.status){for(var e=this,t=e._events,r=e.status?e.value:e.reason,n=e.status?0:1,o=0;o<t.length;o++)!function(t){var o=t[n],i=t[2];u(o,r,i,e.status)}(t[o]);t=[]}}function u(t,r,n,o){var i=n.resolve,u=n.reject;"function"==typeof t?e(function(){var e;try{e=t(r)}catch(e){return void u(e)}i(e)}):o?i(r):u(r)}var s=function(){};return n.defer=function(){var e=new n(s);return{promise:e,resolve:e.resolve,reject:e.reject}},n.resolve=function(e){return r(e)?e:new n(function(t,r){t(e)})},n.reject=function(e){return new n(function(t,r){r(e)})},n.prototype.toString=function(){return"[object Promise]"},n.prototype.then=function(e,t){var r=this.status,o=n.defer(),i=o.promise;return~r?r&&"function"==typeof e?u(e,this.value,i,r):r||"function"!=typeof t?r?o.resolve(this.value):o.reject(this.reason):u(t,this.reason,i,r):this._events.push([e,t,i]),i},n}},{}],4:[function(e,t,r){"use strict";function n(e,t,r){function n(e){if(i(r)){for(var t=!1,n=0;n<r.length;n++)if(r[n]==e){t=!0;break}if(!t)return!1}return!v||!s(h[e])}function o(e,t){return u(t)||(t=+t>0?+t:0),function(r){var n,o=h.defer(),s=0,c=function(i){var f=r[i];h.resolve(f).then(function(r){void 0!==t?n.push(r):n[i]=r,(0==--s||!e&&t&&n.length>=t)&&o.resolve(n)},function(e){u(t)?o.reject(e):0==--s&&o.resolve(n)}),s++};if(i(r)){n=[],0==r.length&&o.resolve(n);for(var a=0;a<r.length;a++)c(a)}else if(e&&f(r)){var l=0;n={};for(var a in r)c(a),l++;0==l&&o.resolve(n)}else o.reject(new TypeError("参数错误"));return o.promise}}function a(e){for(var t=h.defer(),r=0;r<e.length;r++)!function(){var n=r,o=e[n];h.resolve(o).then(function(e){t.resolve(e)},function(e){t.reject(e)})}();return t.promise}function l(e){return function(t,r){if(t)return e.reject(t);e.resolve(r)}}function p(e){var t=this===h?null:this,r=h.defer(),n=c(arguments,1);return n.push(l(r)),e.apply(t,n),r.promise}var h,v;if(t?(v=!0,h=t):h=e,h.Promise||e==t||(h.Promise=e),s(e)&&s(e.prototype.then))h.defer=function(){var t,r;return{promise:new e(function(e,n){t=e,r=n}),resolve:t,reject:r}};else if(s(e.defer))h.defer=function(){return e.defer()};else{if(!s(e.deferred))throw new TypeError("此类不支持扩展!");h.defer=function(){return e.deferred()}}return n("delay")&&(h.delay=function(e,t){var r=h.defer();return setTimeout(function(){r.resolve(t)},e),r.promise}),n("resolve")&&(h.resolve=function(e){var t=h.defer();return t.resolve(e),t.promise}),n("reject")&&(h.reject=function(e){var t=h.defer();return t.reject(e),t.promise}),n("all")&&(h.all=o()),n("allMap")&&(h.allMap=o(!0)),n("some")&&(h.some=function(e,t){return t=+t>=0?+t:0,o(!1,t)(e)}),n("map")&&(h.map=function(e,t,r){function n(){if(f<c.length){var r=c[f],s=h.resolve(t(e[r],r,e)).then(function(e){return n(),e},o.reject);i.push(s),u--,f++}else h.all(i).then(o.resolve,o.reject)}var o=h.defer(),i=[],u=r?+r.concurrency:0;if(0==u||u!=u){for(var s in e)i.push(t(e[s],s,e));return h.all(i).then(o.resolve,o.reject),o.promise}var f=0,c=function(){var t=[];for(var r in e)t.push(r);return t}();do{n()}while(u>0&&f<c.length);return o.promise}),n("race")&&(h.race=a),n("any")&&(h.any=a),n("nfcall")&&(h.nfcall=p),n("nfapply")&&(h.nfapply=function(e,t){var r=this===h?null:this,n=h.defer();if(!i(t))throw TypeError('"args" is not Array');return t.push(l(n)),e.apply(r,t),n.promise}),h.denodeify=function(e){var t=this===h?null:this;return function(){return p.apply(t,[].concat([e],c(arguments)))}},h}var o=e("./utils"),i=o.isArray,u=o.isEmpty,s=o.isFunction,f=o.isPlainObject,c=o.arg2arr;t.exports=n},{"./utils":5}],5:[function(e,t,r){"use strict";r.isPlainObject=function(e){return null!==e&&"object"==typeof e&&!e.nodeType&&e!==e.window&&!(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))},r.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isEmpty=function(e){return void 0===e||null===e},r.arg2arr=function(e,t,r){return Array.prototype.slice.call(e,t,r)}},{}],6:[function(e,t,r){function n(e){function t(e){y=r.Q=r.Promise=o.extendPromise(e)}function r(e,t){function r(){if(y<v&&!w&&h.length>0){var e,t=h.shift(),r=0,o=+u("timeout",t,a),i=u("retry",t,a),c=u("retryIsJump",t,a),l=t._options.self,p=function(){if(e&&clearTimeout(e),e=0,r++)return!0;y--},d=function(){f(t,a,"workFinally",a,a,t)},g=function(e){p()||(t.defer.resolve(e),f(t,a,"workResolve",a,e,a,t),d())},A=function(e){p()||(i>t._errNo++?a._addItem(t,c,!0,!1):(t.defer.reject(e),f(t,a,"workReject",a,e,a,t)),d())};0!=y||j||(j=!0,s.call(a,"queueStart",a,a));m(function(){return t.fn.apply(l||null,t.regs)}).then(g,A).then(function(){h.length>0?n():0==y&&j&&(j=!1,s.call(a,"queueEnd",a,a))});return y+=1,void(o>0&&(e=setTimeout(function(){A("timeout")},o)))}return!0}function n(){for(;!r(););}var a=this,p={queueStart:null,queueEnd:null,workAdd:null,workResolve:null,workReject:null,workFinally:null,retry:0,retryIsJump:!1,timeout:0},h=[],v=o.getPositiveInt(e),y=0,j=!1,w=0;if(this._options=p,this.onError=d,o.isObject(t))for(var g in t)p.hasOwnProperty(g)&&(p[g]=t[g]);this.getMax=function(){return v},this.setMax=function(e){try{v=o.getPositiveInt(e),!w&&y&&a.start()}catch(e){l.call(a,e)}},this.getLength=function(){return h.length},this.getRunCount=function(){return y},this.isStart=function(){return!!j},this._addItem=function(e,t,r,o){if(!(e instanceof i))throw new TypeError('"unit" is not QueueUnit');t?h.unshift(e):h.push(e),o||c.call(a,e),r?a.start():j&&n()},this.start=function(){w=0,n()},this.stop=function(){w=1},this.clear=function(e){for(;h.length;){h.shift().defer.reject(e)}}}function i(e,t,r){var n={workResolve:!0,workReject:!0,workFinally:!0,queueEventTrigger:!0,regs:[],self:null},i=["workResolve","workReject","workFinally","queueEventTrigger","retry","retryIsJump","timeout","self"],u=1;if(!o.isFunction(e))throw new TypeError("Queues only support function, '"+e+"' is not function");this.fn=e,this._errNo=0,this.defer=y.defer(),o.isArray(t)&&(this.regs=t,u++),this._options=n;var s=arguments[u];if(o.isObject(s))for(var f in s)(function(e){for(var t=0;t<i.length;t++)if(e===i[t])return!0;return!1})(f)&&(n[f]=s[f])}function u(e,t,r){return e in t._options?t._options[e]:r._options[e]}function s(e,t){var r=this._options[e],n=o.arg2arr(arguments,2);if(!o.isFunction(r))return!!r;try{return r.apply(t,n)}catch(e){l.call(t,e)}}function f(e,t){var r=e._options.queueEventTrigger,n=o.arg2arr(arguments,2);!1!==s.apply(e,n)&&r&&s.apply(t,n)}function c(e){s.call(this,"workAdd",this,e,this)}function a(e,t,r){return new i(e,t,r)}function l(e){o.isFunction(this.onError)&&this.onError.call(this,e)}function p(e,t,r,n){function i(i){var u=n?o.toArray([e[i]],[i],[e]):o.toArray(e[i]);s[i]=[t,u,r]}var u=o.isArray(e),s=u?[]:{};if(u)for(var f=0;f<e.length;f++)i(f);else for(var c in e)i(c);return s}function h(e,t,r){var n,i=2;return o.isObject(r)&&(n=r,i++),{con:n,start:arguments[i],jump:arguments[++i]}}function v(e,t){var r,n=this.queue,o=this.map,i=this.each,u=h.apply(null,arguments);return r=p(e,t,u.con,i),o?n.addProps(r,u.start,u.jump):n.addArray(r,u.start,u.jump)}var y;t(e);var d=function(e){console.error(e)},m=function(e){return o.runFn2Promise(y,e)};return r.prototype={option:function(e){if(1==arguments.length)return this._options[e];arguments.length>1&&(this._options[e]=arguments[1])},push:function(){var e=this,t=a.apply(e,arguments);return e._addItem(t,!1),t.defer.promise},unshift:function(){var e=this,t=a.apply(e,arguments);return e._addItem(t,!0),t.defer.promise},go:function(){var e=this,t=a.apply(e,arguments);return e._addItem(t,!1,!0),t.defer.promise},jump:function(){var e=this,t=a.apply(e,arguments);return e._addItem(t,!0,!0),t.defer.promise},add:function(e,t){var r,n,i,u,s,f=this,c=1;if(!o.isFunction(e))throw new TypeError("Queues only support function, '"+e+"' is not function");return r=function(){var t=y.defer();return e(t.resolve,t.reject),t.promise},n=[r],o.isObject(t)&&(n.push(t),c++),i=!!arguments[c],u=!!arguments[c+1],s=u?f.unshift.apply(f,n):f.push.apply(f,n),i&&f.start(),s},addArray:function(e,t,r){for(var n=[],i=this,u=0;u<e.length;u++)+function(){var t=u,s=o.toArray(e[t]),f=r?i.unshift.apply(i,s):i.push.apply(i,s);n.push(f)}();var s=y.defer();return y.all(n).then(function(e){s.resolve(e)},function(e){s.reject(e)}),t&&i.start(),s.promise},addProps:function(e,t,r){var n={},i=this;for(var u in e)+function(){var t=u,s=o.toArray(e[t]),f=r?i.unshift.apply(i,s):i.push.apply(i,s);n[t]=f}();var s=y.defer();return y.allMap(n).then(function(e){s.resolve(e)},function(e){s.reject(e)}),t&&i.start(),s.promise},addLikeArray:function(e,t,r){return v.apply({queue:this},arguments)},addLikeProps:function(e,t,r){return v.apply({queue:this,map:!0},arguments)},addLikeArrayEach:function(e,t,r){return v.apply({queue:this,each:!0},arguments)},addLikePropsEach:function(e,t,r){return v.apply({queue:this,each:!0,map:!0},arguments)}},r.use=t,r.createUse=n,r}var o=e("./utils");t.exports=n},{"./utils":7}],7:[function(e,t,r){var n=e("extend-promise/src/extendClass");r.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isObject=function(e){return"object"==typeof e&&null!==e},r.arg2arr=function(e,t,r){return Array.prototype.slice.call(e,t,r)},r.toArray=function(){return Array.prototype.concat.apply([],arguments)},r.getPositiveInt=function(e){var t=+e>>0;if(t>=1)return t;throw new Error('The "max" value is invalid')},r.extendPromise=function(e){return n(e,{})},r.runFn2Promise=function(e,t){try{return e.resolve(t())}catch(t){return e.reject(t)}}},{"extend-promise/src/extendClass":4}]},{},[1]);